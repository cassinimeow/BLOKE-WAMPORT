<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>Elizander Aguila</title>
        <link rel="icon" type="image/png" href="cassini_assets/images/cassini_icon.png" />
        <link rel="stylesheet" href="cassini.css" />
    </head>
    <body>
        <canvas id="cassini"></canvas>
        <canvas id="cassini-panorama"></canvas>
        <div class="overlay"></div>
        <div class="vignette"></div>
        <div class="cassini-blur-overlay"></div>
        <!-- This line adds the full-page blur -->

        <div class="cassini-content">
            <section class="profile">
                <img src="cassini_assets/images/me.jpg" alt="Elizander Aguila" class="profile-pic" />
                <h1 class="mc-title">Elizander Aguila</h1>
            </section>

            <section class="cassini-section">
                <h2 class="mc-subtitle">Hobbies</h2>
                <div class="cassini-list">
                    <div class="cassini-item">
                        <div class="image-container">
                            <button class="arrow left" onclick="prevImage(this)">&#9664;</button>
                            <img
                                src="cassini_assets/images/game1.jpg"
                                data-images='["cassini_assets/images/game1.jpg","cassini_assets/images/game2.jpg","cassini_assets/images/game3.jpg"]'
                                alt="Playing Games"
                            />
                            <button class="arrow right" onclick="nextImage(this)">&#9654;</button>
                        </div>
                        <button class="mc-button" onclick="toggleCassini(this)">Playing Games</button>
                        <p class="cassini-desc mc-text">
                            I enjoy exploring different genres — adventure, survival, and sandbox games. They help me
                            unwind, think creatively, and connect with friends online.
                        </p>
                    </div>

                    <div class="cassini-item">
                        <div class="image-container">
                            <button class="arrow left" onclick="prevImage(this)">&#9664;</button>
                            <img
                                src="cassini_assets/images/anime1.jpg"
                                data-images='["cassini_assets/images/anime1.jpg","cassini_assets/images/anime2.jpg"]'
                                alt="Watching Anime"
                            />
                            <button class="arrow right" onclick="nextImage(this)">&#9654;</button>
                        </div>
                        <button class="mc-button" onclick="toggleCassini(this)">Watching Anime & Movies</button>
                        <p class="cassini-desc mc-text">
                            I love immersing myself in stories full of imagination and emotion. They inspire my
                            creativity and broaden my perspective.
                        </p>
                    </div>

                    <div class="cassini-item">
                        <div class="image-container">
                            <button class="arrow left" onclick="prevImage(this)">&#9664;</button>
                            <img
                                src="cassini_assets/images/tinkering.jpg"
                                data-images='["cassini_assets/images/tinkering.jpg","cassini_assets/images/tinkering2.jpg"]'
                                alt="Tinkering"
                            />
                            <button class="arrow right" onclick="nextImage(this)">&#9654;</button>
                        </div>
                        <button class="mc-button" onclick="toggleCassini(this)">Tinkering with My Computer</button>
                        <p class="cassini-desc mc-text">
                            I enjoy customizing and improving my system. Learning how computers work gives me a sense of
                            control and curiosity about technology.
                        </p>
                    </div>
                </div>
            </section>

            <section class="cassini-section">
                <h2 class="mc-subtitle">Goals</h2>
                <div class="cassini-list">
                    <div class="cassini-item">
                        <div class="image-container">
                            <button class="arrow left" onclick="prevImage(this)">&#9664;</button>
                            <img
                                src="cassini_assets/images/goal1.jpg"
                                data-images='["cassini_assets/images/goal1.jpg","cassini_assets/images/goal1b.jpg","cassini_assets/images/goal1c.jpg"]'
                                alt="Networking"
                            />
                            <button class="arrow right" onclick="nextImage(this)">&#9654;</button>
                        </div>
                        <button class="mc-button" onclick="toggleCassini(this)">Gain Knowledge on Networking</button>
                        <p class="cassini-desc mc-text">
                            I want to strengthen my understanding of network systems, routing, and security.
                        </p>
                    </div>

                    <div class="cassini-item">
                        <div class="image-container">
                            <button class="arrow left" onclick="prevImage(this)">&#9664;</button>
                            <img
                                src="cassini_assets/images/goal2.jpg"
                                data-images='["cassini_assets/images/goal2.jpg","cassini_assets/images/goal2b.jpg"]'
                                alt="Homelab"
                            />
                            <button class="arrow right" onclick="nextImage(this)">&#9654;</button>
                        </div>
                        <button class="mc-button" onclick="toggleCassini(this)">Have My Own Homelab</button>
                        <p class="cassini-desc mc-text">
                            Building a homelab will let me test setups and run servers for hands-on learning.
                        </p>
                    </div>

                    <div class="cassini-item">
                        <div class="image-container">
                            <button class="arrow left" onclick="prevImage(this)">&#9664;</button>
                            <img
                                src="cassini_assets/images/goal3.jpg"
                                data-images='["cassini_assets/images/goal3.jpg","cassini_assets/images/goal3b.jpg"]'
                                alt="Engineer"
                            />
                            <button class="arrow right" onclick="nextImage(this)">&#9654;</button>
                        </div>
                        <button class="mc-button" onclick="toggleCassini(this)">Become a Network Engineer</button>
                        <p class="cassini-desc mc-text">
                            My long-term goal is to design secure, efficient networks as a professional engineer.
                        </p>
                    </div>
                </div>
            </section>
        </div>

        <!-- Modal for Enlarged Image -->
        <div id="imageModal" class="image-modal">
            <span class="close-modal">&times;</span>
            <button class="arrow left" onclick="prevModalImage()">&#10094;</button>
            <img id="modalImg" src="" alt="Expanded view" />
            <button class="arrow right" onclick="nextModalImage()">&#10095;</button>
        </div>

        <script>
            /* =============== Toggle Descriptions =============== */
            function toggleCassini(button) {
                const desc = button.nextElementSibling;
                desc.classList.toggle("show");
            }

            /* =============== Image Carousel =============== */
            function fadeImage(img, newSrc) {
                img.style.opacity = 0;
                setTimeout(() => {
                    img.src = newSrc;
                    img.style.opacity = 1;
                }, 300);
            }

            function nextImage(button) {
                const img = button.parentElement.querySelector("img");
                const images = JSON.parse(img.dataset.images);
                let index = parseInt(img.dataset.index || 0);
                index = (index + 1) % images.length;
                img.dataset.index = index;
                fadeImage(img, images[index]);
            }

            function prevImage(button) {
                const img = button.parentElement.querySelector("img");
                const images = JSON.parse(img.dataset.images);
                let index = parseInt(img.dataset.index || 0);
                index = (index - 1 + images.length) % images.length;
                img.dataset.index = index;
                fadeImage(img, images[index]);
            }

            /* =============== Image Modal (Click-to-Enlarge) =============== */
            document.addEventListener("DOMContentLoaded", () => {
                const modal = document.getElementById("imageModal");
                const modalImg = document.getElementById("modalImg");
                const closeModal = document.querySelector(".close-modal");

                document.querySelectorAll(".image-container img").forEach(img => {
                    img.addEventListener("click", () => {
                        modal.style.display = "flex";
                        modalImg.src = img.src;
                    });
                });

                closeModal.addEventListener("click", () => {
                    modal.style.display = "none";
                });

                window.addEventListener("click", e => {
                    if (e.target === modal) modal.style.display = "none";
                });
            });
            let modalIndex = 0;
            let modalImages = [];

            document.querySelectorAll(".image-container img").forEach(img => {
                img.addEventListener("click", () => {
                    const modal = document.getElementById("imageModal");
                    const modalImg = document.getElementById("modalImg");

                    modalImages = JSON.parse(img.dataset.images);
                    modalIndex = modalImages.findIndex(src => img.src.includes(src.split("/").pop()));
                    modalImg.src = img.src;

                    modal.classList.add("show");
                });
            });

            document.querySelector(".close-modal").addEventListener("click", () => {
                document.getElementById("imageModal").classList.remove("show");
            });

            window.addEventListener("click", e => {
                const modal = document.getElementById("imageModal");
                if (e.target === modal) modal.classList.remove("show");
            });

            function nextModalImage() {
                modalIndex = (modalIndex + 1) % modalImages.length;
                document.getElementById("modalImg").src = modalImages[modalIndex];
            }

            function prevModalImage() {
                modalIndex = (modalIndex - 1 + modalImages.length) % modalImages.length;
                document.getElementById("modalImg").src = modalImages[modalIndex];
            }
        </script>

        <div class="overlay"></div>
        <div class="vignette"></div>

        <script>
            // Cassini smooth panorama background
            const files = [
                "cassini_assets/background/panorama_0.png",
                "cassini_assets/background/panorama_1.png",
                "cassini_assets/background/panorama_2.png",
                "cassini_assets/background/panorama_3.png",
                "cassini_assets/background/panorama_4.png",
                "cassini_assets/background/panorama_5.png",
            ];

            const canvas = document.getElementById("cassini");
            const ctx = canvas.getContext("2d", { alpha: false });

            ctx.imageSmoothingEnabled = true;
            ctx.imageSmoothingQuality = "high";

            let panoramaCanvas = null;
            let panoramaWidth = 0;
            let panoramaHeight = 0;
            let panX = 0;
            let speed = 80; // lower = slower
            let lastTime = 0;
            let scale = 1;

            function loadImages(list) {
                return Promise.all(
                    list.map(
                        src =>
                            new Promise(resolve => {
                                const img = new Image();
                                img.onload = () => resolve({ img, ok: true });
                                img.onerror = () => resolve({ img: null, ok: false });
                                img.src = src;
                            })
                    )
                );
            }

            function makeFallbackPan(width, height) {
                const off = document.createElement("canvas");
                off.width = width;
                off.height = height;
                const g = off.getContext("2d");
                for (let i = 0; i < 6; i++) {
                    const x = i * (width / 6);
                    const grad = g.createLinearGradient(x, 0, x + width / 6, height);
                    grad.addColorStop(0, "#334");
                    grad.addColorStop(1, "#112");
                    g.fillStyle = grad;
                    g.fillRect(x, 0, width / 6, height);
                }
                return off;
            }

            function buildPanorama(results) {
                const valid = results.filter(r => r.ok && r.img);
                if (valid.length === 0) {
                    panoramaCanvas = makeFallbackPan(2048, 768);
                    panoramaWidth = panoramaCanvas.width;
                    panoramaHeight = panoramaCanvas.height;
                    return;
                }

                const heights = valid.map(v => v.img.height);
                const targetH = Math.min(...heights);
                const mats = results.map(r => {
                    if (!r.ok || !r.img) return null;
                    const s = targetH / r.img.height;
                    return { img: r.img, width: Math.round(r.img.width * s), height: targetH };
                });

                panoramaWidth = mats.reduce((sum, m) => sum + (m ? m.width : 0), 0);
                panoramaHeight = targetH;

                const off = document.createElement("canvas");
                off.width = panoramaWidth;
                off.height = panoramaHeight;
                const g = off.getContext("2d");

                let x = 0;
                for (const m of mats) {
                    if (!m) {
                        g.fillStyle = "#222";
                        g.fillRect(x, 0, Math.round(panoramaWidth / 6), panoramaHeight);
                        x += Math.round(panoramaWidth / 6);
                        continue;
                    }
                    g.drawImage(m.img, 0, 0, m.img.width, m.img.height, x, 0, m.width, m.height);
                    x += m.width;
                }

                panoramaCanvas = off;
            }

            function resize() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                scale = (canvas.height / panoramaHeight) * 1.05;
            }

            function renderFrame(time) {
                if (!lastTime) lastTime = time;
                const dt = (time - lastTime) / 1000;
                lastTime = time;

                panX += speed * dt;
                if (panX >= panoramaWidth) panX -= panoramaWidth;

                const destW = canvas.width;
                const destH = canvas.height;

                const srcW = destW / scale;
                const srcH = panoramaHeight;
                let sx = panX % panoramaWidth;

                ctx.drawImage(panoramaCanvas, sx, 0, srcW, srcH, 0, 0, destW, destH);

                if (sx + srcW > panoramaWidth) {
                    const rem = sx + srcW - panoramaWidth;
                    ctx.drawImage(panoramaCanvas, 0, 0, rem, srcH, (panoramaWidth - sx) * scale, 0, rem * scale, destH);
                }

                requestAnimationFrame(renderFrame);
            }

            loadImages(files)
                .then(results => {
                    buildPanorama(results);
                    resize();
                    window.addEventListener("resize", resize);
                    requestAnimationFrame(renderFrame);
                })
                .catch(err => {
                    console.error("Cassini panorama failed:", err);
                    panoramaCanvas = makeFallbackPan(2048, 768);
                    panoramaWidth = panoramaCanvas.width;
                    panoramaHeight = panoramaCanvas.height;
                    resize();
                    requestAnimationFrame(renderFrame);
                });
        </script>

        <!-- 🔊 Speaker Toggle -->
        <button id="soundToggle" class="sound-toggle">
            <img id="soundIcon" src="cassini_assets/images/sound-on.png" alt="Sound On" />
        </button>
        <script>
            document.addEventListener("DOMContentLoaded", () => {
                // 🎵 Load sounds
                const clickSound = new Audio("cassini_assets/sounds/click.ogg");
                const bgMusic = new Audio("cassini_assets/sounds/bg-music.mp3"); // ← updated name

                bgMusic.loop = true;
                bgMusic.volume = 0.4; // softer background music
                let soundEnabled = true;
                let musicStarted = false;

                // 🔘 Create a speaker icon (bottom-right corner)
                const speaker = document.createElement("div");
                speaker.id = "speaker-toggle";
                speaker.innerHTML = "🔊";
                speaker.style.position = "fixed";
                speaker.style.bottom = "20px";
                speaker.style.right = "20px";
                speaker.style.fontSize = "2rem";
                speaker.style.cursor = "pointer";
                speaker.style.color = "white";
                speaker.style.zIndex = "2000";
                document.body.appendChild(speaker);

                // 🎚️ Toggle mute/unmute
                speaker.addEventListener("click", () => {
                    soundEnabled = !soundEnabled;
                    if (soundEnabled) {
                        speaker.innerHTML = "🔊";
                        bgMusic.play().catch(() => {});
                    } else {
                        speaker.innerHTML = "🔇";
                        bgMusic.pause();
                    }
                });

                // ▶️ Allow music to start after first user interaction
                const startMusic = () => {
                    if (!musicStarted) {
                        musicStarted = true;
                        bgMusic.play().catch(() => {});
                    }
                };
                document.addEventListener("click", startMusic, { once: true });

                // 🖱️ Play click sound for buttons & arrows
                const playClick = () => {
                    if (soundEnabled) {
                        clickSound.currentTime = 0;
                        clickSound.play().catch(() => {});
                    }
                };

                document.querySelectorAll("button, .arrow").forEach(el => {
                    el.addEventListener("click", playClick);
                });
            });
        </script>
    </body>
</html>
